<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book Cleaning | EcoShine</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- AOS Animation -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/booking.css">
  <link rel="icon" type="image/x-icon" href="./imgs/logo.png">

</head>

<body class="booking-bg">
  <!-- Navbar -->
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold fs-4" href="index.html">
        <i class="bi bi-sun me-2 text-warning"></i> EcoShine
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto text-center align-items-center" id="navLinks">
          <!-- These links will be replaced dynamically -->
          <li class="nav-item"><a class="nav-link " href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="register.html">Register</a></li>
          <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
          <li class="nav-item"><a class="nav-link active" href="#">Book Cleaning</a></li>
          <li class="nav-item"><a class="nav-link" id="dashboardLink" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">How are We</a></li>
          
        </ul>
      </div>
    </div>
  </nav>
  <!-- Animated Background Icons -->
  <div class="solar-icons">
    <i class="bi bi-sun"></i>
    <i class="bi bi-lightning-charge"></i>
    <i class="bi bi-brightness-high"></i>
    <i class="bi bi-sun"></i>
    <i class="bi bi-lightning-charge"></i>
  </div>

  <!-- Booking Section -->
  <section class="booking-section d-flex align-items-center justify-content-center py-5 mt-5">
    <div class="container" data-aos="zoom-in">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <div class="booking-card glass-card p-4 p-md-5 shadow-lg rounded-4">
            <div class="text-center mb-4">
              <div class="icon-circle mb-3">
                <i class="bi bi-calendar-check display-5 text-warning"></i>
              </div>
              <h2 class="fw-bold text-warning">Schedule a Cleaning</h2>
              <p class="text-muted">Book your next solar cleaning session with our smart robots ü§ñ</p>
            </div>

            <form id="bookingForm">
              <div class="form-floating mb-3">
                <input type="text" id="name" class="form-control" placeholder="Full Name" required>
                <label for="name"><i class="bi bi-person me-2"></i>Full Name</label>
              </div>

              <div class="form-floating mb-3">
                <input type="tel" id="phone" class="form-control" placeholder="Phone Number" pattern="[0-9+ ]{7,15}"
                  required>
                <label for="phone"><i class="bi bi-telephone me-2"></i>Phone Number</label>
              </div>

              <div class="form-floating mb-3">
                <input type="email" id="email" class="form-control" placeholder="Email" required>
                <label for="email"><i class="bi bi-envelope me-2"></i>Email Address</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" id="address" class="form-control" placeholder="Address" required>
                <label for="address"><i class="bi bi-geo-alt me-2"></i>Address</label>
              </div>

              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="date" id="date" class="form-control" required>
                    <label for="date"><i class="bi bi-calendar3 me-2"></i>Date</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="time" id="time" class="form-control" required>
                    <label for="time"><i class="bi bi-clock me-2"></i>Time</label>
                  </div>
                </div>
              </div>

              <div class="form-floating mb-3">
                <input type="url" id="panelPhoto" class="form-control" placeholder="Panel Image URL">
                <label for="panelPhoto"><i class="bi bi-image me-2"></i>Current Panel Image URL</label>
              </div>

              <div class="form-floating mb-4">
                <textarea class="form-control" id="notes" style="height:100px;" placeholder="Notes"></textarea>
                <label for="notes"><i class="bi bi-chat-dots me-2"></i>Additional Notes</label>
              </div>



              <button type="submit" class="btn btn-warning btn-lg w-100 fw-bold glow-btn">
                <i class="bi bi-send-fill me-2"></i>Confirm Booking
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-4 bg-dark text-light text-center">
    <div class="container">
      <p class="mb-0">¬© <span id="year"></span> EcoShine </p>
    </div>
  </footer>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 1000, once: true });
    document.getElementById('year').textContent = new Date().getFullYear();

    // Form submission
    // document.getElementById('bookingForm').addEventListener('submit', (e) => {
    //   e.preventDefault();
    //   alert("‚úÖ Booking Confirmed Successfully!");
    //   e.target.reset();
    // });
  </script>

  <!-- Firebase connection -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, update }
      from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL }
      from "https://www.gstatic.com/firebasejs/12.4.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBGSfwSqmK239i6CMP5mIItp_Xj-mwYV2I",
      authDomain: "solar-cleaning-website.firebaseapp.com",
      databaseURL: "https://solar-cleaning-website-default-rtdb.firebaseio.com",
      projectId: "solar-cleaning-website",
      storageBucket: "solar-cleaning-website.appspot.com",
      messagingSenderId: "454039844879",
      appId: "1:454039844879:web:8051aac69c8ac7baf50b7a",
      measurementId: "G-THCL9Q4WYX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    // make them global
    window.db = db;
    window.ref = ref;
    window.set = set;
    window.push = push;
    window.onValue = onValue;
    window.update = update;
    window.storage = storage;
    window.sRef = sRef;
    window.uploadBytes = uploadBytes;
    window.getDownloadURL = getDownloadURL;
  </script>

  <script>
    const navLinks = document.getElementById("navLinks");
    const user = JSON.parse(localStorage.getItem("loggedUser"));

    if (user) {
      // Profile image
      let imgSrc = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
      if (user.panelPhoto && user.panelPhoto.includes("drive.google")) {
        const match = user.panelPhoto.match(/[-\w]{25,}/);
        if (match) imgSrc = `https://drive.google.com/uc?export=view&id=${match[0]}`;
      } else if (user.panelPhoto) {
        imgSrc = user.panelPhoto;
      }

      // Rebuild Navbar
      navLinks.innerHTML = `
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link active" href="#">Book Cleaning</a></li>
      <li class="nav-item"><a class="nav-link" href="My Bookings.html"">My Book Cleaning</a></li>
      ${user.isAdmin ? `
      <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a>
        </li>            
        <li class="nav-item"><a class="nav-link " href="messages.html">Client Messages</a></li>
        <li class="nav-item"><a class="nav-link " href="users managment.html">Manage Users</a></li>
        ` : ""}  
        <li class="nav-item"><a class="nav-link" href="about.html"">How are We</a></li>
        
      <li class="nav-item dropdown ms-3">
        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown"
           role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <img src="${imgSrc}" alt="User" class="rounded-circle me-2" style="width:35px; height:35px; object-fit:cover;">
          <span class="fw-bold text-warning">${user.fullName.split(" ")[0]}</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li><a class="dropdown-item" href="profile.html"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </li>
    `;

      // Logout function
      document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("loggedUser");
        window.location.href = "login.html";
      });
    }

    if (user) {
      document.getElementById('bookingForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const address = document.getElementById('address').value.trim();
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const notes = document.getElementById('notes').value.trim();
        const panelPhoto = document.getElementById('panelPhoto').value.trim();
        const phone = document.getElementById('phone').value.trim();

        if (!name || !email || !address || !date || !time) {
          alert("‚ö†Ô∏è Please fill in all required fields.");
          return;
        }

        try {
          // Push new booking under bookings node
          const bookingRef = push(ref(db, `bookings`));
          const bookingData = {
            username: user.username,
            name,
            email,
            phone,
            address,
            date,
            time,
            notes,
            panelPhoto,
            status: false,
            bookedAt: new Date().toISOString()
          };

          await set(bookingRef, bookingData);

          alert("‚úÖ Booking confirmed successfully!");
          e.target.reset();
        } catch (err) {
          console.error("Booking error:", err);
          alert("‚ùå Error submitting booking. Check console.");
        }
      });
    } else {
      document.getElementById('bookingForm').addEventListener('submit', (e) => {
        e.preventDefault();
        alert("‚ö†Ô∏è You must be logged in to book a cleaning!");
        window.location.href = "login.html";
      });
    }


  </script>
  <script>
    // Get the dashboard link
    const dashboardLink = document.getElementById("dashboardLink");
    if (dashboardLink) dashboardLink.style.display = "none"; // Hide by default


    if (user && user.isAdmin === true) {
      // Show dashboard for admins
      dashboardLink.style.display = "block";
    } else {
      // Make sure it's hidden for normal users or guests
      if (dashboardLink) dashboardLink.style.display = "none";
    }


  </script>

</body>

</html>